name: ğŸ§  Auto-Fix Gradle Wrapper

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fix-wrapper:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      - name: â˜• Configurar Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: ğŸ§© Verificar e corrigir Gradle Wrapper
        run: |
          echo "ğŸ” Verificando arquivos do Gradle Wrapper..."

          mkdir -p gradle/wrapper

          # gradle-wrapper.properties
          if [ ! -f gradle/wrapper/gradle-wrapper.properties ]; then
            echo "ğŸ§± Criando gradle-wrapper.properties..."
            cat > gradle/wrapper/gradle-wrapper.properties <<'EOF'
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.7-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
EOF
          else
            echo "âœ… gradle-wrapper.properties jÃ¡ existe â€” ignorado."
          fi

          # gradle-wrapper.jar
          if [ ! -f gradle/wrapper/gradle-wrapper.jar ]; then
            echo "ğŸ“¦ Gerando gradle-wrapper.jar..."
            mkdir temp && cd temp
            echo "task wrapper(type: Wrapper) { gradleVersion = '8.7' }" > build.gradle
            gradle wrapper
            cp gradle/wrapper/gradle-wrapper.jar ../gradle/wrapper/
            cd ..
            rm -rf temp
          else
            echo "âœ… gradle-wrapper.jar jÃ¡ existe â€” ignorado."
          fi

          # gradlew script
          if [ ! -f gradlew ]; then
            echo "ğŸ“ Criando gradlew..."
            gradle wrapper
          else
            echo "âœ… gradlew jÃ¡ existe â€” ignorado."
          fi

          # gradlew.bat script
          if [ ! -f gradlew.bat ]; then
            echo "ğŸ“ Criando gradlew.bat..."
            gradle wrapper
          else
            echo "âœ… gradlew.bat jÃ¡ existe â€” ignorado."
          fi

          chmod +x gradlew
          echo "âœ… Todos os arquivos do Gradle Wrapper foram verificados e corrigidos com sucesso!"

      - name: ğŸ’¾ Commit e push do wrapper atualizado
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add gradle gradlew gradlew.bat || true
          git commit -m "ğŸ¤– Auto-fix Gradle Wrapper" || echo "Nenhuma alteraÃ§Ã£o detectada"
          git push || echo "Nenhum push necessÃ¡rio"
